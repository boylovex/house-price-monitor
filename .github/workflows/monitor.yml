name: æˆºé™¢ç½‘é¡µç›‘æ§

on:
  schedule:
    # æ¯å¤©ä¸Šåˆ6ç‚¹æ‰§è¡Œ (UTC+8 å°æ¹¾æ—¶é—´)
    - cron: '0 22 * * *'  # UTCæ˜¯22:00ï¼Œä¹Ÿå°±æ˜¯å°æ¹¾æ—¶é—´09:00
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  monitor:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“… æ‹‰å–ä»“åº“
        uses: actions/checkout@v4
        with:
          fetch-depth: 10

      - name: ğŸ”§ è®¾ç½® Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: ğŸ“† å®‰è£…ä¾èµ–
        run: |
          npm install && npx playwright install chromium
      - name: ğŸ–¾ï¸ ç²—å–æ•°æ®
        run: node scripts/fetch-listings.js
        continue-on-error: true

      - name: ğŸ” æ£€æŸ¥å˜åŒ–
        id: check
        run: node scripts/check-changes.js
        continue-on-error: true

      - name: ğŸ“„ æäº¤æ•°æ®
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add data/
          git commit -m "ğŸ¤– æ›´æ–°æˆºé˜«æ•°æ®å¿«ç…§ - $(date +%Y-%m-%d\\ %H:%M:%S)" || echo "æ— æ–°å˜åŒ–"
        continue-on-error: true
